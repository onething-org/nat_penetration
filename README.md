#### 两个处于不同内网的机器通过 TCP/IP 协议进行通讯

假设我们有两台处于不同内网的两台机器 A 和 B 以及一台众所周知外网 IP 的服务器 S，机器 A 中运行着通讯的服务端程序，B 运行着通讯的客户端程序，那么

1. A 连接 S，S 记录 A 的外网 IP 与通讯端口
2. B 连接 S
3. S 将 A 与此通讯的端口号返回给 A
4. S 将 A 与此连接的 IP 与端口号返回给 B
5. A 在程序中将服务绑定并侦听在从 S 返回的端口
6. B 使用从 S 返回的 IP 与端口连接 A

这样A与B就成功连接了

*需要注意的是两个 socket 在同一个端口绑定的问题，socket 提供了 setsockopt 函数，其中参数 SO_REUSEADDR 可以解决这个问题*